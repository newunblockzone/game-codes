try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c3613445-abe9-4d30-8ab0-fc39cfb2684b",e._sentryDebugIdIdentifier="sentry-dbid-c3613445-abe9-4d30-8ab0-fc39cfb2684b")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1622],{13201:e=>{e.exports={SubscribeBanner:"SubscribeBanner_SubscribeBanner__GPym6",RosieMessage:"SubscribeBanner_RosieMessage__7zaYY",fadeAndScaleIn:"SubscribeBanner_fadeAndScaleIn___eFuq",fadeAndScaleOut:"SubscribeBanner_fadeAndScaleOut__qCHGu"}},27156:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var a,r,o=n(12115);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}let i=function(e){return o.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 22 22"},e),a||(a=o.createElement("path",{d:"M11.917 11.917v7.333h1.833v-3.666h1.833V13.75h3.667v-1.833h-7.333m-3.667-5.5V2.75h1.833v7.333H2.75V8.25h5.5-1.833V6.417z"})),r||(r=o.createElement("path",{d:"M11.917 11.917v7.333h1.833v-3.666h1.833V13.75h3.667v-1.833h-7.333m-3.667-5.5V2.75h1.833v7.333H2.75V8.25h5.5-1.833V6.417zM11.917 10.083h7.333V8.25h-3.667V6.417H13.75V2.75h-1.833v7.333m-5.5 3.667H2.75v-1.833h7.333v7.333H8.25v-5.5 1.833H6.417z"})))}},29361:(e,t,n)=>{"use strict";n.d(t,{Nb:()=>I,O$:()=>H});var a=n(95155),r=n(95838),o=n(5041),s=n(12115),i=n(65521),c=n(23464),l=n(35695);let u=c.A.create({baseURL:"https://api.staging.opengameprotocol.com"});async function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n.headers={...n.headers,Authorization:"Bearer ".concat(t),"x-auth-provider":"player"};try{return await u(e,n)}catch(e){var a;throw c.A.isAxiosError(e)&&(null==(a=e.response)?void 0:a.status)===404&&(0,l.notFound)(),e}}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.headers={...t.headers,"Content-Type":"application/json"},await u(e,t)}async function g(e,t){return(await f("/game/getSessionToken?playerId=".concat(e,"&apiKey=").concat("b772733e-0d91-44f5-93ad-9d0ae979ba42","&gameId=").concat(t),{method:"GET"})).data}async function p(e){return(await d("/game/savePoints",e.token,{method:"POST",data:{points:e.points}})).data}var m=n(99975),h=n(69740),b=n(82104),v=n.n(b);function w(e){let{onSignIn:t}=e,{isSignedIn:n,signOut:r,requireSignIn:o}=(0,h.A)(),s=async()=>{n?r():o({callbackIfSignedIn:()=>{t()},autoCloseDialog:!0})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:"You have earned points, but they will be lost unless you sign in to Rosebud!"}),(0,a.jsx)("button",{className:v().OGPAuthButton,onClick:s,children:"Sign In to Rosebud"})]})}var y=n(70689);let A=(0,i.v)(e=>({ogpInstance:null,setOgpInstance:t=>e({ogpInstance:t})}));async function S(e){let t=new(await n.e(4897).then(n.bind(n,74897))).default({useCustomAuth:!0});return t.init({gameId:e}),t.gameReadyToPlay(),t}let I=["3bebe390-06da-4b16-a84c-b0db380a00b5","f34b869b-eb9c-4fe9-afa1-c7f9d0b86d4e","69b4edcb-4ff5-437b-80a2-208208e39c51","9381a1a1-6021-4769-a3bb-352427681e3b","623e16a2-d7a1-4a65-9447-c8732659562d","d20f4673-b62d-4a76-8564-f64a839f7136","56a9fb21-bb68-4819-bd9c-a841f8c3289c"];function H(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0,[i,c]=(0,s.useState)(!1),{setOpen:l,setContent:u}=(0,y.s)(),d=(0,s.useRef)(!1),{ogpInstance:f,setOgpInstance:h}=A(),b=null!==f;(0,s.useEffect)(()=>{let e=async()=>{!b&&(f||h(await S(n)))};I.includes(n)&&e()},[n,b,f,h]),(0,s.useEffect)(()=>{b&&void 0!==e&&b&&f.setPlayerId(e)},[e,b,f]),(0,s.useEffect)(()=>{(0,m.yu)().then(e=>{b&&void 0!==e&&f&&(console.log("Setting custom auth token: ".concat(e)),f.setCustomAuthToken(e))})},[b,f]);let{data:v,refetch:H}=(0,r.I)({queryKey:["ogp-user-session",e],queryFn:()=>g(e,n),enabled:void 0!==e&&i}),_=null==v?void 0:v.data.token,V=(0,o.n)({mutationFn:p,onError:()=>{console.error("Submit points error")},onSettled:()=>{console.log("Submit points success")}});async function x(){if(b&&f)return await f.getPoints()}async function C(){if(b&&f)return(await f.listGameRewards()).total}async function E(){if(b&&f)return await f.claimRewards(!0)}return{submitPoints:(0,s.useCallback)(async n=>{if(t&&!d.current){d.current=!0,u({body:(0,a.jsx)(w,{onSignIn:()=>l(!1)}),title:"Sign in required to save points"}),l(!0);return}let r=_;if(!i&&void 0!==e){var o;c(!0),r=null==(o=(await H()).data)?void 0:o.data.token}if(r)return(await V.mutateAsync({token:r,points:n})).data.savePoints},[i,e,_,t,V,H,u,l]),listPoints:x,listRewards:C,claimRewards:E,isSDKLoaded:b}}},30546:(e,t,n)=>{"use strict";n.d(t,{_:()=>a});let a="16"},35758:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a,r=n(12115);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}let s=function(e){return r.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 22"},e),a||(a=r.createElement("path",{fill:"currentColor",d:"M11.917 2.75h7.333v7.333h-1.833V6.417h-1.834V4.583h-3.666zm-7.334 9.167v3.666h1.834v1.834H4.583h5.5v1.833H2.75v-7.333zM19.25 11.917v7.333h-7.333v-1.833h3.666v-1.834h1.834v-3.666zm-9.167-7.334H6.417v1.833H4.583V4.583v5.5H2.75V2.75h7.333z"})))}},43614:(e,t,n)=>{"use strict";n.d(t,{B:()=>r});var a=n(66977);function r(e){if(e==a.Kt.BABYLON)return"babylon";if(e==a.Kt.PHASER)return"phaser";if(e==a.Kt.VOXEL)return"noa";if(e==a.Kt.THREEJS)return"threejs";if(e==a.Kt.REACT)return"react";else if(e==a.Kt.MULTIFILE)return"esm-react";throw Error("Project mode not supported!")}},47745:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var a=n(95155),r=n(66766),o=n(6874),s=n.n(o),i=n(94784),c=n(13201),l=n.n(c);function u(e){let{message:t}=e;return(0,a.jsxs)("div",{className:l().SubscribeBanner,children:[(0,a.jsxs)("div",{className:l().RosieMessage,children:[(0,a.jsx)(r.default,{src:i.default,alt:"Rosie Portrait",height:40,width:40,className:l().RosiePortrait}),(0,a.jsx)("span",{children:t})]}),(0,a.jsx)(s(),{href:"/profile/my-plan",children:"Upgrade Plan"})]})}},61297:(e,t,n)=>{"use strict";var a;n.d(t,{Fi:()=>o,Yq:()=>s,un:()=>r});let r=void 0!==(null==(a=window.webkit)?void 0:a.messageHandlers);async function o(e){let t=e.data.content;if(r){var n;null==(n=window.webkit)||n.messageHandlers.callbackHandler.postMessage({action:"IframeLocalStorageChanged",content:JSON.stringify(t)})}}function s(){if(r){var e;null==(e=window.webkit)||e.messageHandlers.callbackHandler.postMessage({action:"NoEntitlementsRemaining"})}}},77268:e=>{e.exports={RenderDiv:"GenericCanvasContainer_RenderDiv__xU0or",Root:"GenericCanvasContainer_Root__IxnDc",FullScreen:"GenericCanvasContainer_FullScreen__I0tZg",FullScreenButton:"GenericCanvasContainer_FullScreenButton__f3PIA",SubscribeBannerContainer:"GenericCanvasContainer_SubscribeBannerContainer__OWwYS",InfiniteErrorContainer:"GenericCanvasContainer_InfiniteErrorContainer___kPqL",fadeAndScaleIn:"GenericCanvasContainer_fadeAndScaleIn__dDSmk",fadeAndScaleOut:"GenericCanvasContainer_fadeAndScaleOut__L_fKF"}},82104:e=>{e.exports={OGPAuthButton:"OgpSignInDialog_OGPAuthButton__xNQRo",fadeAndScaleIn:"OgpSignInDialog_fadeAndScaleIn__Q3PKl",fadeAndScaleOut:"OgpSignInDialog_fadeAndScaleOut__8qv2z"}},90200:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var a=n(95155),r=n(52596),o=n(12115),s=n(88248),i=n(99975),c=n(35758),l=n(27156),u=n(47745),d=n(30546);let f=()=>(0,a.jsx)("svg",{width:d._,height:d._,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.8335 0.833008H9.16683V2.49967H7.50016V4.16634H5.8335V5.83301L4.16683 5.83301V7.49967H2.50016V9.16634H0.833496V10.833L2.50016 10.833V12.4997H4.16683V14.1663H5.8335V15.833H7.50016V17.4997H9.16683V19.1663H10.8335L10.8335 17.4997H12.5002V15.833H14.1668V14.1663H15.8335L15.8335 12.4997H17.5002V10.833L19.1668 10.833V9.16634H17.5002V7.49967H15.8335V5.83301L14.1668 5.83301V4.16634H12.5002V2.49967H10.8335V0.833008ZM10.8335 2.49967L10.8335 4.16634H12.5002V5.83301H14.1668V7.49967H15.8335L15.8335 9.16634H17.5002V10.833H15.8335V12.4997H14.1668V14.1663H12.5002V15.833L10.8335 15.833V17.4997H9.16683V15.833L7.50016 15.833V14.1663H5.8335V12.4997H4.16683V10.833H2.50016V9.16634H4.16683V7.49967H5.8335V5.83301H7.50016V4.16634H9.16683V2.49967H10.8335ZM10.8335 5.83301H9.16683V10.833H10.8335V5.83301ZM10.8335 12.4997H9.16683V14.1663H10.8335V12.4997Z",fill:"currentColor"})});var g=n(80757),p=n(29361),m=n(61297),h=n(77268),b=n.n(h);let v=(0,o.forwardRef)(function(e,t){let{files:n,projectId:d,canvasType:h,onEvalError:v,onScriptsLoaded:w,showFullScreenButton:y=!0}=e,{isSignedIn:A,requireSignIn:S,user:I}=(0,g.As)(),[H,_]=(0,o.useState)(),[V,x]=(0,o.useState)(!1),C=(0,o.useRef)(null),[E,R]=(0,o.useState)(!1),{submitPoints:j}=(0,p.O$)(null==I?void 0:I.id,null==I?void 0:I.is_anonymous,d),O=(0,o.useRef)(null),L=(0,o.useRef)(0),M=(0,o.useRef)(null),[k,P]=(0,o.useState)(!1);async function q(e){C.current&&C.current.contentWindow&&C.current.contentWindow.postMessage({action:"setLocalStorage",data:e},"*")}async function B(e){let t,n=e.data.payload,a=e.data.requestId;try{t={blob:await (0,s.mP)(n)}}catch(e){console.error(e),t={message:"Error fetching asset generation response"}}e.source.postMessage({action:"ephemeralImageGenerationResponse",content:t,requestId:a},e.origin)}if((0,o.useImperativeHandle)(t,()=>({iframe:C.current,takeScreenshot:()=>new Promise((e,t)=>{var n;if(!(null==(n=C.current)?void 0:n.contentWindow))return console.error("[MultiFile] Cannot request screenshot: iframe not ready."),e(null);if(O.current)return console.warn("[MultiFile] Screenshot request already in progress."),t(Error("Screenshot request already in progress."));O.current=e,C.current.contentWindow.postMessage({action:"requestScreenshot"},"*");let a=setTimeout(()=>{O.current&&(console.error("[MultiFile] Screenshot request timed out."),O.current(null),O.current=null)},5e3),r=O.current;O.current=e=>{clearTimeout(a),r&&r(e),O.current=null}})}),[]),(0,o.useEffect)(()=>{m.un&&(window.setIframeLocalStorage=q)},[]),(0,o.useEffect)(()=>{if(void 0===H){let e="".concat("https://canvas.play.rosebud.ai","/canvas/").concat(h);e+="phaser"===h&&m.un?"_webkit":"",_(e+=window.location.hash)}},[H,h]),(0,o.useEffect)(()=>{async function e(e){let t;(0,i.mO)(d);let n=e.data.payload;n.project_id=d;let a=e.data.requestId;try{t=await (0,s.rJ)(n)}catch(n){var r,o;let e="Error fetching LLM response";(null==(r=n.response)?void 0:r.status)===403&&(null==(o=n.response.data)?void 0:o.detail)==="No more entitlements available"&&(m.un?(0,m.Yq)():A?R(!0):S({callbackIfSignedOut:()=>{}}),e=m.un||A?"Subscribe for unlimited messages":"Sign in to continue using AI Chat"),console.error(n),t={message:e}}e.source.postMessage({action:"llmResponse",content:t,requestId:a},e.origin)}async function t(e){let t=e.data.points;(0,i.YH)(t);let n=e.data.requestId,a=await j(t);e.source.postMessage({action:"ogpSubmitPoints",content:a,requestId:n},e.origin)}let n=async n=>{let a=n.data.action;if("codeError"===a&&v&&(L.current++,M.current||(M.current=setTimeout(()=>{L.current>10&&P(!0),M.current=null,L.current=0},1e3)),v(n.data.content)),"logProgress"===a&&(0,i.n1)(n.data.content.eventName,n.data.content.eventData),"scriptsLoaded"===a&&w&&w(n.data.content),"requestLLM"===a&&await e(n),"localStorageChanged"===a&&await (0,m.Fi)(n),"requestEphemeralImageGeneration"===a&&await B(n),"ogpSubmitPoints"===a&&await t(n),"screenshotResponse"===a){let{content:e}=n.data;O.current&&O.current(e)}};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},[v,w,d,A,S,j]),0===n.length)return(0,a.jsx)("div",{children:"No files"});if(n.some(e=>!e))return(0,a.jsx)("div",{children:"Some files are missing"});function N(){C.current&&C.current.contentWindow&&C.current.contentWindow.postMessage({type:"fileSystem",files:n},"*")}return(0,a.jsxs)("div",{className:(0,r.A)(b().Root,V&&b().FullScreen),children:[y&&(0,a.jsx)("button",{onClick:()=>{x(e=>!e)},className:b().FullScreenButton,children:V?(0,a.jsx)(l.A,{}):(0,a.jsx)(c.A,{})}),!k&&(0,a.jsx)("iframe",{ref:C,src:H,className:b().RenderDiv,sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-downloads allow-forms allow-popups",onLoad:()=>setTimeout(N,100),allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;"}),k&&(0,a.jsxs)("div",{className:b().InfiniteErrorContainer,children:[(0,a.jsx)(f,{}),(0,a.jsx)("span",{children:"Infinite error loop detected. Please check your code."})]}),E&&(0,a.jsx)("div",{className:b().SubscribeBannerContainer,children:(0,a.jsx)(u.A,{message:"To continue enjoying the AI chat features in this project, please upgrade your plan."})})]})})},94784:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});let a={src:"/_next/static/media/rosie-starry-eyed-portrait-icon.7c031611.png",height:1080,width:1080,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAilBMVEW+PWtLHTS1WHn0zMGoLlulY3y9XoFrI1vM//+WIkz/u7v/1NuvOFuzWnS1RmPZQnPQNmluO1eeFU7dnqurQmy4MmPJfIOfNmyuUXODMGXbgphzGFySVn/lqqt9Fl6YPm7OaYylDUKFMU+JBDy9OGThcIzMO29tI0GqOGCiLGrdtKmxfID71smZJmUWntRlAAAAIXRSTlO5/fr+3HYglwL6DySzZav8/GP5PdbY/bisOv2HiPt8f/777doIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAASklEQVR4nAXBBQKAIBAEwEVBxO6uAzv+/z1n4HphBOG48AMiIp4jNVmcKCPRnGrfqrUANHtudpSAtkbb0hzzt9hvd9VwJjkI2bc/qecFCqrQCfYAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}},95152:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var a=n(95155),r=n(52596),o=n(12115),s=n(88248),i=n(99975),c=n(35758),l=n(27156),u=n(47745),d=n(80757),f=n(29361),g=n(61297),p=n(77268),m=n.n(p);let h=(0,o.forwardRef)(function(e,t){let{file:n,projectId:p,canvasType:h,onEvalError:b,onScriptsLoaded:v,showFullScreenButton:w=!0}=e,{isSignedIn:y,requireSignIn:A,user:S}=(0,d.As)(),[I,H]=(0,o.useState)(),[_,V]=(0,o.useState)(!1),x=(0,o.useRef)(null),[C,E]=(0,o.useState)(!1),{submitPoints:R}=(0,f.O$)(null==S?void 0:S.id,null==S?void 0:S.is_anonymous,p);async function j(e){x.current&&x.current.contentWindow&&x.current.contentWindow.postMessage({action:"setLocalStorage",data:e},"*")}async function O(e){let t,n=e.data.payload,a=e.data.requestId;try{t={blob:await (0,s.mP)(n)}}catch(e){console.error(e),t={message:"Error fetching asset generation response"}}e.source.postMessage({action:"ephemeralImageGenerationResponse",content:t,requestId:a},e.origin)}function L(){if(!x.current||!x.current.contentWindow)return;let e={action:"update",content:n.content};x.current.contentWindow.postMessage(e,"*")}return(0,o.useImperativeHandle)(t,()=>x.current,[x]),(0,o.useEffect)(()=>{g.un&&(window.setIframeLocalStorage=j)},[]),(0,o.useEffect)(()=>{if(void 0===I){let e="".concat("https://canvas.play.rosebud.ai","/canvas/").concat(h);e+="phaser"===h&&g.un?"_webkit":"",H(e+=window.location.hash)}},[I,h]),(0,o.useEffect)(()=>{async function e(e){let t;(0,i.mO)(p);let n=e.data.payload;n.project_id=p;let a=e.data.requestId;try{t=await (0,s.rJ)(n)}catch(n){var r,o;let e="Error fetching LLM response";(null==(r=n.response)?void 0:r.status)===403&&(null==(o=n.response.data)?void 0:o.detail)==="No more entitlements available"&&(g.un?(0,g.Yq)():y?E(!0):A({callbackIfSignedOut:()=>{}}),e=g.un||y?"Subscribe for unlimited messages":"Sign in to continue using AI Chat"),console.error(n),t={message:e}}e.source.postMessage({action:"llmResponse",content:t,requestId:a},e.origin)}async function t(e){let t=e.data.points;(0,i.YH)(t);let n=e.data.requestId,a=await R(t);e.source.postMessage({action:"ogpSubmitPoints",content:a,requestId:n},e.origin)}let a=async n=>{let{action:a}=n.data;"codeError"===a&&b&&b(n.data.content),"logProgress"===a&&(0,i.n1)(n.data.content.eventName,n.data.content.eventData),"scriptsLoaded"===a&&v&&v(n.data.content),"requestLLM"===a&&await e(n),"localStorageChanged"===a&&await (0,g.Fi)(n),"requestEphemeralImageGeneration"===a&&await O(n),"ogpSubmitPoints"===a&&await t(n)};if(n.content)return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},[b,n.content,v,p,y,A,R]),(0,a.jsxs)("div",{className:(0,r.A)(m().Root,_&&m().FullScreen),children:[w&&(0,a.jsx)("button",{onClick:()=>{V(e=>!e)},className:m().FullScreenButton,children:_?(0,a.jsx)(l.A,{}):(0,a.jsx)(c.A,{})}),(0,a.jsx)("iframe",{ref:x,src:I,className:m().RenderDiv,sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-downloads allow-forms allow-popups",onLoad:()=>setTimeout(L,100),allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;"},"".concat(n.id,"-").concat(n.modified)),C&&(0,a.jsx)("div",{className:m().SubscribeBannerContainer,children:(0,a.jsx)(u.A,{message:"To continue enjoying the AI chat features in this project, please upgrade your plan."})})]})})}}]);