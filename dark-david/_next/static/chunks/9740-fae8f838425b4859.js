try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="f9632472-6747-4ddc-a744-e0feb5dbc482",e._sentryDebugIdIdentifier="sentry-dbid-f9632472-6747-4ddc-a744-e0feb5dbc482")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9740],{11389:(e,t,a)=>{a.d(t,{b:()=>h});var n=a(26715),i=a(23915),r=a(16203),s=a(12115),o=a(88248),c=a(99975),d=a(70689),u=a(70247),l=a(71086);let h=()=>{let{setOpen:e,setContent:t}=(0,d.s)(),a=(0,u.Y)(),h=(0,n.jE)();return{handleOAuthSignIn:(0,s.useCallback)(async n=>{try{let e=await (0,r.df)(c.e7,n),{isNewUser:t}=(0,r.B8)(e)||{isNewUser:!1},i={provider:"firebase",token:await e.user.getIdToken(),...t&&a?{utm:a}:{}},s=await (0,o.Uu)(i);l.J.set(s);let d=await (0,o.HW)();return h.setQueryData(["users","me"],d),(0,c.h2)(),!0}catch(a){return a instanceof i.g&&"auth/account-exists-with-different-credential"===a.code?(e(!0),t({title:"Sign-in Error",body:"An account with the same email already exists with a different sign-in provider. Please try a different method."})):(console.error(a),e(!0),t({title:"Sign-in Error",body:"There was an error signing you in. Please try again."})),!1}},[e,t,a,h])}}},69740:(e,t,a)=>{a.d(t,{A:()=>y});var n=a(26715),i=a(95838),r=a(16203),s=a(12115),o=a(88248),c=a(99975),d=a(70689),u=a(71086),l=a(86786),h=a(91992),p=a(11389);let m=()=>{let[e,t]=(0,s.useState)(!1);return{token:(0,s.useSyncExternalStore)(e=>{let a=u.J.subscribe(e);return t(!0),a},u.J.getRosebudToken,()=>null),isLoaded:e}},f=!1,g=null,y=()=>{let e=(0,n.jE)(),{setOpen:t,setContent:a}=(0,d.s)(),{isSigningInWithMagicLink:y,setIsSigningInWithMagicLink:w,setSuccessfulLoginHandler:_,setDialogOpen:T}=(0,l.l)(),{token:b}=m(),{handleOAuthSignIn:E}=(0,p.b)(),{handleEmailSignIn:k}=(0,h.e)({setIsSigningInWithMagicLink:w}),[S,v]=(0,s.useState)(!1),[I,O]=(0,s.useState)(!1),P=(0,i.I)({queryKey:["users","me",null==b?void 0:b.access],queryFn:o.HW,enabled:!!b});if(P.data){var x;S||v(!0);let e=!(null==(x=P.data)?void 0:x.is_anonymous);I!==e&&(O(e),e&&(f=!1))}let A=(0,s.useCallback)(async()=>{(0,c.mR)(),await (0,r.CI)(c.e7),e.clear(),u.J.clear(),f=!1,O(!1)},[e]);(0,s.useEffect)(()=>{b&&0>=u.J.getSecondsTilExpiry()&&I&&A().then(()=>{t(!0),a({title:"Session expired",body:"You have been signed out. Please sign in again to continue."})})},[b,A,t,a,I]),(0,s.useEffect)(()=>{!f&&S&&(b||(f=!0,(0,o.Os)().then(e=>{u.J.set(e),O(!1)})))},[b,e,S]);let C=(0,s.useCallback)(async()=>{if(b){if(g)return g;if(u.J.isRefreshTokenExpired())return Promise.reject(Error("Token expired."));g=(0,o.iD)({refresh:b.refresh});try{let{access:e}=await g;return u.J.set({access:e,refresh:b.refresh}),{access:e}}finally{g=null}}},[b]);return(0,s.useEffect)(()=>{if(!b)return;let e=setTimeout(()=>{C().catch(e=>{console.error("Error refreshing access token",e),A().then(()=>{t(!0),a({title:"Session expired",body:"You have been signed out. Please sign in again to continue."})})})},1e3*u.J.getSecondsTilAccessTokenExpiry());return()=>clearTimeout(e)},[C,b,A,t,a]),{isLoaded:S,user:P.data,accessToken:null==b?void 0:b.access,isSignedIn:I,isSigningInWithMagicLink:y,signOut:A,requireSignIn:function(e){let{callbackIfSignedIn:t,callbackIfSignedOut:a,autoCloseDialog:n}=e;I?null==t||t():(null==a||a(),t&&_(()=>{n&&T(!1),t(),_(()=>{})}),T(!0))},handleOAuthSignIn:E,handleEmailSignIn:k}}},70247:(e,t,a)=>{a.d(t,{Y:()=>c,k:()=>o});var n=a(35695),i=a(12115);let r="rosebud_";var s=function(e){return e.SOURCE="utm_source",e.MEDIUM="utm_medium",e.CAMPAIGN="utm_campaign",e.CONTENT="utm_content",e.TERM="utm_term",e}(s||{});function o(){let e=(0,n.useSearchParams)();(0,i.useEffect)(()=>{let t=e.get("utm_source");t&&localStorage.setItem(r+"utm_source",t);let a=e.get("utm_medium");a&&localStorage.setItem(r+"utm_medium",a);let n=e.get("utm_campaign");n&&localStorage.setItem(r+"utm_campaign",n);let i=e.get("utm_content");i&&localStorage.setItem(r+"utm_content",i);let s=e.get("utm_term");s&&localStorage.setItem(r+"utm_term",s)},[e])}function c(){let e=null;for(let t of Object.values(s)){let a=localStorage.getItem(r+t);a&&(null===e&&(e={}),e[t]=a)}return e}},70689:(e,t,a)=>{a.d(t,{M:()=>i,s:()=>r});var n=a(12115);let i=n.createContext({open:!1,setOpen:()=>{},content:null,setContent:()=>{}}),r=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useDialog must be used within a DialogContextProvider");return e}},71086:(e,t,a)=>{a.d(t,{J:()=>r});var n=a(86447);class i{load(){let e=localStorage.getItem(this._LOCALSTORAGE_KEY);e?this._token=JSON.parse(e):this._token=null,this.notify()}getRosebudToken(){return this.isAccessTokenExpired()&&this.isRefreshTokenExpired()&&(this.expired=!0),this._token}set(e){this.expired=!1,localStorage.setItem(this._LOCALSTORAGE_KEY,JSON.stringify(e)),this._token=e,this.notify()}clear(){localStorage.removeItem(this._LOCALSTORAGE_KEY),this._token=null,this.notify()}notify(){Object.entries(this._subs).forEach(e=>{let[,t]=e;return t()})}subscribe(e){this.isLoaded||(this.load(),this.isLoaded=!0);let t=crypto.randomUUID();return this._subs[t]=e,e(),()=>{delete this._subs[t]}}_parseToken(e){return JSON.parse(atob(e.split(".")[1]))}_isTokenExpired(e){let t=this._parseToken(e);return Math.floor(Date.now()/1e3)>=t.exp}_handleStorageChange(e){e.key===this._LOCALSTORAGE_KEY&&(this.load(),this.isLoaded=!0)}isAccessTokenExpired(){return!this._token||this._isTokenExpired(this._token.access)}isRefreshTokenExpired(){return!this._token||this._isTokenExpired(this._token.refresh)}getSecondsTilExpiry(){return this._token?Math.max(this._parseToken(this._token.access).exp,this._parseToken(this._token.refresh).exp)-Date.now()/1e3:-1}getSecondsTilAccessTokenExpiry(){return this._token?this._parseToken(this._token.access).exp-Date.now()/1e3:-1}getSecondsTilRefreshTokenExpiry(){return this._token?this._parseToken(this._token.refresh).exp-Date.now()/1e3:-1}constructor(){(0,n._)(this,"_LOCALSTORAGE_KEY","rosebud_auth_token"),(0,n._)(this,"_subs",{}),(0,n._)(this,"_token",null),(0,n._)(this,"_refreshPromise",null),(0,n._)(this,"isLoaded",!1),(0,n._)(this,"expired",!1),this.load=this.load.bind(this),this.getRosebudToken=this.getRosebudToken.bind(this),this.set=this.set.bind(this),this.clear=this.clear.bind(this),this.notify=this.notify.bind(this),this.subscribe=this.subscribe.bind(this),this._handleStorageChange=this._handleStorageChange.bind(this),window.addEventListener("storage",this._handleStorageChange)}}let r=new i},86786:(e,t,a)=>{a.d(t,{l:()=>n});let n=(0,a(65521).v)(e=>({isSigningInWithMagicLink:!1,emailInputErrorMessage:"",dialogOpen:!1,authEmailRedirectUrl:"",setIsSigningInWithMagicLink:t=>e({isSigningInWithMagicLink:t}),setEmailInputErrorMessage:t=>e({emailInputErrorMessage:t}),setDialogOpen:t=>e({dialogOpen:t}),handleSuccessfulLogin:()=>{},setSuccessfulLoginHandler:t=>e({handleSuccessfulLogin:t}),setAuthEmailRedirectUrl:t=>e({authEmailRedirectUrl:t})}))},88248:(e,t,a)=>{a.d(t,{AO:()=>R,BL:()=>y,CM:()=>F,DS:()=>I,HW:()=>l,Ii:()=>D,Mz:()=>j,NH:()=>L,Os:()=>m,RL:()=>U,Rc:()=>v,TK:()=>O,U1:()=>g,Uf:()=>K,Uu:()=>p,V1:()=>$,Y7:()=>_,_5:()=>w,aw:()=>Z,cf:()=>x,em:()=>M,gT:()=>C,gt:()=>W,iD:()=>f,jd:()=>S,kO:()=>Y,kW:()=>q,kY:()=>A,ln:()=>V,mP:()=>b,n8:()=>H,nK:()=>B,oh:()=>h,qB:()=>z,rJ:()=>T,rU:()=>E,rr:()=>J,sM:()=>G,tK:()=>Q,uS:()=>X,vr:()=>k,wL:()=>N,xx:()=>P});var n=a(23464),i=a(35695),r=a(71086);let s=n.A.create({baseURL:"https://playground-gateway-v2-snduoq54tq-uc.a.run.app",paramsSerializer:{indexes:null}}),o=null;async function c(){let e=r.J.getRosebudToken();if(!e)return Promise.reject(Error("Token expired."));if(r.J.isAccessTokenExpired()){if(o)return await o;if(r.J.isRefreshTokenExpired())return Promise.reject(Error("Token expired."));o=f({refresh:e.refresh});try{let{access:t}=await o;return r.J.set({access:t,refresh:e.refresh}),{access:t}}finally{o=null}}return{access:e.access}}async function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{access:a}=await c();t.headers={...t.headers,Authorization:"Bearer ".concat(a)};try{return await s(e,t)}catch(e){var r;throw n.A.isAxiosError(e)&&(null==(r=e.response)?void 0:r.status)===404&&(0,i.notFound)(),e}}async function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.headers={...t.headers,"Content-Type":"application/json"},await s(e,t)}async function l(){return(await d("/api/users/me/",{method:"GET"})).data}async function h(e){return(await d("/api/entitlements/".concat(e,"/"),{method:"GET"})).data}async function p(e){return(await u("/api/token/sign-in/",{method:"POST",data:e})).data}async function m(){return(await u("/api/token/sign-in-anonymous/",{method:"POST"})).data}async function f(e){return(await u("/api/token/refresh/",{method:"POST",data:e})).data}async function g(e){return void 0===e?Promise.reject(Error("Invalid id")):(await d("/api/projects/".concat(e,"/"),{method:"GET"})).data}async function y(e){return(await d("/api/published-projects/".concat(e,"/clone/"),{method:"POST"})).data}async function w(e,t){await d("/api/projects/".concat(e,"/add_asset/"),{method:"POST",data:{asset_id:t}})}async function _(e,t){await d("/api/projects/".concat(e,"/remove_asset/"),{method:"POST",data:{asset_id:t}})}async function T(e){return(await d("/api/in-game/call-llm",{method:"POST",data:e})).data}async function b(e){return(await d("/api/in-game/generate-image",{method:"POST",data:e,responseType:"blob"})).data}async function E(e){await d("/api/plays/",{method:"POST",data:e})}async function k(e){let{id:t,...a}=e,n=a.preview_image?{"Content-Type":"multipart/form-data"}:void 0;return void 0===t?Promise.reject(Error("Invalid id")):(await d("/api/projects/".concat(t,"/"),{method:"PATCH",data:a,headers:n})).data}async function S(e,t){await d("/api/projects/".concat(e,"/set_current_revision/"),{method:"POST",data:t})}async function v(e,t){await d("/api/projects/".concat(e,"/publish_revision/"),{method:"POST",data:{revision_id:t}})}async function I(e,t){return(await d("/api/projects/".concat(e,"/deploy_revision/"),{method:"POST",data:{revision_id:t}})).data}async function O(e){return(await d("/api/users/".concat(e.id,"/"),{method:"PATCH",data:e})).data}async function P(e){if(void 0===e)return Promise.reject(Error("Invalid id"));await d("/api/projects/".concat(e,"/"),{method:"DELETE"})}async function x(e){return(await d("/api/projects/",{method:"GET",params:e})).data}async function A(e){return(await u("api/published-projects/",{method:"GET",params:e})).data}async function C(e){return(await d("/api/assets/".concat(e.id,"/"),{method:"PATCH",data:e})).data}async function L(e){return(await d("/api/assets/",{method:"GET",params:e})).data}async function j(e){let t=new FormData;return t.append("description",e.description),t.append("blob",e.blob),e.preview_blob&&t.append("preview_blob",e.preview_blob),(await d("/api/assets/upload/",{method:"POST",data:t})).data}async function R(e){await d("/api/assets/".concat(e.id,"/"),{method:"DELETE"})}async function D(e){return(await d("/api/assets/generate/",{method:"POST",data:e})).data}async function G(e){return(await d("/api/asset-generation-models/",{method:"GET",params:e})).data}async function J(e){return(await d("/api/chats/",{method:"GET",params:e})).data}async function U(e){return(await d("/api/chats/",{method:"POST",data:e})).data}async function M(e){return(await d("/api/commits/",{method:"GET",params:e})).data}async function Y(e){return(await d("/api/commits/".concat(e,"/"),{method:"GET"})).data}async function H(e){await d("/api/commits/".concat(e,"/"),{method:"DELETE"})}async function N(e){await d("/api/commits/bulk_delete/",{method:"PATCH",data:{ids:e}})}async function K(e){return(await d("/api/files/",{method:"POST",data:e})).data}async function $(e){let{id:t,...a}=e;return(await d("/api/files/".concat(t,"/"),{method:"PATCH",data:a})).data}async function q(e){return(await d("/api/files/".concat(e,"/"),{method:"GET"})).data}async function B(e){return(await d("/api/files/",{method:"GET",params:e})).data}async function W(e){return(await d("/api/revisions/",{method:"GET",params:e})).data}async function z(e){return(await d("/api/revisions/".concat(e,"/"),{method:"GET"})).data}async function F(e){return(await d("/api/revisions/",{method:"POST",data:e})).data}async function Q(e){let{id:t,...a}=e;return(await d("/api/revisions/".concat(t,"/"),{method:"PATCH",data:a})).data}async function V(e){await d("/api/revisions/".concat(e,"/"),{method:"DELETE"})}async function X(){return(await d("/api/subscriptions",{method:"GET"})).data}async function Z(e){return(await d("/api/subscriptions",{method:"PATCH",data:{products:{},active_product_and_price:[e.product_id,e.price_id],referral_id:e.referral_id}})).headers["x-link"]||null}},91992:(e,t,a)=>{a.d(t,{e:()=>f});var n=a(26715),i=a(16203),r=a(35695),s=a(12115),o=a(88248),c=a(99975),d=a(70689),u=a(86786),l=a(70247),h=a(71086);let p="rosebud_auth_email",m=!1,f=e=>{let{setIsSigningInWithMagicLink:t}=e,{setOpen:a,setContent:f}=(0,d.s)(),g=(0,l.Y)(),y=(0,n.jE)(),w=(0,r.useRouter)(),{isSigningInWithMagicLink:_}=(0,u.l)(),T=(0,s.useCallback)(async(e,t)=>{let n=""===t?"https://rosebud.ai/":t;if(!n)return console.error("Improperly configured sign in with email redirect_uri!"),!1;if(g){let e=new URL(n);Object.keys(g).forEach(t=>{let a=g[t];a&&e.searchParams.append(t,a)}),n=e.toString()}let r={url:n,handleCodeInApp:!0};window.localStorage.setItem(p,e);try{return await (0,i.MN)(c.e7,e,r),a(!0),f({title:"Email Sent",body:"Email Sent. Please check your inbox."}),!0}catch(e){return console.error("Error sending email link:",e),a(!0),f({title:"Send Error",body:"Error sending the sign-in link. Please try again."}),!1}},[a,f,g]),b=(0,s.useCallback)(async()=>{try{let e=window.localStorage.getItem(p);if(!e){a(!0),f({title:"Sign-in Error",body:"Invalid Sign In Link. Please try again."});return}let t=await (0,i.hK)(c.e7,e,window.location.href),{isNewUser:n}=(0,i.B8)(t)||{isNewUser:!1},r={provider:"firebase",token:await t.user.getIdToken(),...n&&g?{utm:g}:{}},s=await (0,o.Uu)(r);h.J.set(s);let d=await (0,o.HW)();y.setQueryData(["users","me"],d),window.localStorage.removeItem(p),(0,c.h2)()}catch(e){console.error("Error signing in with email link:",e),a(!0),f({title:"Sign-in Error",body:"There was an error signing you in. Please try again."})}finally{t(!1),w.replace("/")}},[a,f,g,t,y,w]);return(0,s.useEffect)(()=>{m||_||((0,i.Pj)(c.e7,window.location.href)&&(t(!0),b()),m=!0)},[b,_,t]),{handleEmailSignIn:T,handleEmailLinkSignIn:b}}},99975:(e,t,a)=>{a.d(t,{Ty:()=>f,YH:()=>w,_l:()=>T,e7:()=>o,eO:()=>h,h2:()=>p,mO:()=>l,mR:()=>m,n1:()=>_,qM:()=>g,u_:()=>u,v9:()=>y,yu:()=>c});var n=a(86864),i=a(23915),r=a(16203);let s=(0,i.Wp)({apiKey:"AIzaSyBf_rz3aBYRJp4xDN9qYEU1XJKLq9n5l_g",authDomain:"auth.rosebud.ai",projectId:"playground-ad6bc",storageBucket:"playground-ad6bc.appspot.com",messagingSenderId:"978544999762",appId:"1:978544999762:web:216673e705db232b70ce8b"}),o=(0,r.xI)(s);async function c(){var e;return await (null==(e=o.currentUser)?void 0:e.getIdToken())}let d=null;(0,n.TT)().then(e=>{e?(d=(0,n.P5)(s),(0,r.hg)(o,e=>{e&&d?(0,n.do)(d,e.uid):d&&(0,n.do)(d,null)})):console.warn("Firebase Analytics is not supported in this environment")});let u=()=>{d&&(0,n.$s)(d,"websocket-submit-prompt")},l=e=>{d&&(0,n.$s)(d,"submit-character-message",{projectId:e})},h=e=>{d&&(0,n.$s)(d,"generate-asset",e)},p=()=>{d&&(0,n.$s)(d,"sign-in")},m=()=>{d&&(0,n.$s)(d,"sign-out")},f=()=>{d&&(0,n.$s)(d,"copy-code")},g=()=>{d&&(0,n.$s)(d,"apply-code")},y=()=>{d&&(0,n.$s)(d,"auto-apply-code")},w=e=>{d&&(0,n.$s)(d,"ogp-submit-points",{points:e})},_=(e,t)=>{d&&(0,n.$s)(d,e,t)},T=()=>{d&&(0,n.$s)(d,"one-shot-attempt")}}}]);