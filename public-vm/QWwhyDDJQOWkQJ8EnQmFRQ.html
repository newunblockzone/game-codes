<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="icon" href="data:,"><title>Hyperbeam</title></head><body id="root"><script type="module">!function(){const e=(()=>{if("undefined"==typeof self)return!1;if("top"in self&&self!==top)try{top.window.document._=0}catch(e){return!1}return"showOpenFilePicker"in self})(),t=e?Promise.resolve().then((function(){return o})):Promise.resolve().then((function(){return l}));async function n(...e){return(await t).default(...e)}e?Promise.resolve().then((function(){return s})):Promise.resolve().then((function(){return u})),e?Promise.resolve().then((function(){return c})):Promise.resolve().then((function(){return d}));const r=async e=>{const t=await e.getFile();return t.handle=e,t};var o={__proto__:null,default:async(e=[{}])=>{Array.isArray(e)||(e=[e]);const t=[];e.forEach(((e,n)=>{t[n]={description:e.description||"Files",accept:{}},e.mimeTypes?e.mimeTypes.map((r=>{t[n].accept[r]=e.extensions||[]})):t[n].accept["*/*"]=e.extensions||[]}));const n=await window.showOpenFilePicker({id:e[0].id,startIn:e[0].startIn,types:t,multiple:e[0].multiple||!1,excludeAcceptAllOption:e[0].excludeAcceptAllOption||!1}),o=await Promise.all(n.map(r));return e[0].multiple?o:o[0]}};function i(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return i=function(e){this.s=e,this.n=e.next},i.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new i(e)}const a=async(e,t,n=e.name,r)=>{const o=[],s=[];var c,l=!1,u=!1;try{for(var d,f=function(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new i(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(e.values());l=!(d=await f.next()).done;l=!1){const i=d.value,c=`${n}/${i.name}`;"file"===i.kind?s.push(i.getFile().then((t=>(t.directoryHandle=e,t.handle=i,Object.defineProperty(t,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>c}))))):"directory"!==i.kind||!t||r&&r(i)||o.push(a(i,t,c,r))}}catch(e){u=!0,c=e}finally{try{l&&null!=f.return&&await f.return()}finally{if(u)throw c}}return[...(await Promise.all(o)).flat(),...await Promise.all(s)]};var s={__proto__:null,default:async(e={})=>{e.recursive=e.recursive||!1,e.mode=e.mode||"read";const t=await window.showDirectoryPicker({id:e.id,startIn:e.startIn,mode:e.mode});return(await(await t.values()).next()).done?[t]:a(t,e.recursive,void 0,e.skipDirectory)}},c={__proto__:null,default:async(e,t=[{}],n=null,r=!1,o=null)=>{Array.isArray(t)||(t=[t]),t[0].fileName=t[0].fileName||"Untitled";const i=[];let a=null;if(e instanceof Blob&&e.type?a=e.type:e.headers&&e.headers.get("content-type")&&(a=e.headers.get("content-type")),t.forEach(((e,t)=>{i[t]={description:e.description||"Files",accept:{}},e.mimeTypes?(0===t&&a&&e.mimeTypes.push(a),e.mimeTypes.map((n=>{i[t].accept[n]=e.extensions||[]}))):a?i[t].accept[a]=e.extensions||[]:i[t].accept["*/*"]=e.extensions||[]})),n)try{await n.getFile()}catch(e){if(n=null,r)throw e}const s=n||await window.showSaveFilePicker({suggestedName:t[0].fileName,id:t[0].id,startIn:t[0].startIn,types:i,excludeAcceptAllOption:t[0].excludeAcceptAllOption||!1});!n&&o&&o(s);const c=await s.createWritable();if("stream"in e){const t=e.stream();return await t.pipeTo(c),s}return"body"in e?(await e.body.pipeTo(c),s):(await c.write(await e),await c.close(),s)}},l={__proto__:null,default:async(e=[{}])=>(Array.isArray(e)||(e=[e]),new Promise(((t,n)=>{const r=document.createElement("input");r.type="file";const o=[...e.map((e=>e.mimeTypes||[])),...e.map((e=>e.extensions||[]))].join();r.multiple=e[0].multiple||!1,r.accept=o||"",r.style.display="none",document.body.append(r);const i=e=>{"function"==typeof a&&a(),t(e)},a=e[0].legacySetup&&e[0].legacySetup(i,(()=>a(n)),r),s=()=>{window.removeEventListener("focus",s),r.remove()};r.addEventListener("click",(()=>{window.addEventListener("focus",s)})),r.addEventListener("change",(()=>{window.removeEventListener("focus",s),r.remove(),i(r.multiple?Array.from(r.files):r.files[0])})),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})))},u={__proto__:null,default:async(e=[{}])=>(Array.isArray(e)||(e=[e]),e[0].recursive=e[0].recursive||!1,new Promise(((t,n)=>{const r=document.createElement("input");r.type="file",r.webkitdirectory=!0;const o=e=>{"function"==typeof i&&i(),t(e)},i=e[0].legacySetup&&e[0].legacySetup(o,(()=>i(n)),r);r.addEventListener("change",(()=>{let t=Array.from(r.files);e[0].recursive?e[0].recursive&&e[0].skipDirectory&&(t=t.filter((t=>t.webkitRelativePath.split("/").every((t=>!e[0].skipDirectory({name:t,kind:"directory"})))))):t=t.filter((e=>2===e.webkitRelativePath.split("/").length)),o(t)})),"showPicker"in HTMLInputElement.prototype?r.showPicker():r.click()})))},d={__proto__:null,default:async(e,t={})=>{Array.isArray(t)&&(t=t[0]);const n=document.createElement("a");let r=e;"body"in e&&(r=await async function(e,t){const n=e.getReader(),r=new ReadableStream({start:e=>async function t(){return n.read().then((({done:n,value:r})=>{if(!n)return e.enqueue(r),t();e.close()}))}()}),o=new Response(r),i=await o.blob();return n.releaseLock(),new Blob([i],{type:t})}(e.body,e.headers.get("content-type"))),n.download=t.fileName||"Untitled",n.href=URL.createObjectURL(await r);const o=()=>{"function"==typeof i&&i()},i=t.legacySetup&&t.legacySetup(o,(()=>i()),n);return n.addEventListener("click",(()=>{setTimeout((()=>URL.revokeObjectURL(n.href)),3e4),o()})),n.click(),null}};let f,p,h;try{f=new TextDecoder}catch(e){}let y=0;const m={};let w,g,v,b,k,x,E,T=11281e4,A=1681e4,R={},S=0,U=0,_=[],P=[],O={useRecords:!1,mapsAsObjects:!0},C=!1,M=2;try{new Function("")}catch(e){M=1/0}class L{constructor(e){if(e&&(!e.keyMap&&!e._keyMap||e.useRecords||(e.useRecords=!1,e.mapsAsObjects=!0),!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.getStructures&&(e.getShared=e.getStructures),e.getShared&&!e.structures&&((e.structures=[]).uninitialized=!0),e.keyMap)){this.mapKey=new Map;for(let[t,n]of Object.entries(e.keyMap))this.mapKey.set(n,t)}Object.assign(this,e)}decodeKey(e){return this.keyMap&&this.mapKey.get(e)||e}encodeKey(e){return this.keyMap&&this.keyMap.hasOwnProperty(e)?this.keyMap[e]:e}encodeKeys(e){if(!this._keyMap)return e;let t=new Map;for(let[n,r]of Object.entries(e))t.set(this._keyMap.hasOwnProperty(n)?this._keyMap[n]:n,r);return t}decodeKeys(e){if(!this._keyMap||"Map"!=e.constructor.name)return e;if(!this._mapKey){this._mapKey=new Map;for(let[e,t]of Object.entries(this._keyMap))this._mapKey.set(t,e)}let t={};return e.forEach(((e,n)=>t[D(this._mapKey.has(n)?this._mapKey.get(n):n)]=e)),t}mapDecode(e,t){let n=this.decode(e);return this._keyMap&&"Array"===n.constructor.name?n.map((e=>this.decodeKeys(e))):n}decode(e,t){if(p)return oe((()=>(ie(),this?this.decode(e,t):L.prototype.decode.call(O,e,t))));h=t>-1?t:e.length,y=0,U=0,g=null,v=null,p=e;try{x=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(p=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof L){if(R=this,k=this.sharedValues&&(this.pack?new Array(this.maxPrivatePackedValues||16).concat(this.sharedValues):this.sharedValues),this.structures)return w=this.structures,I();(!w||w.length>0)&&(w=[])}else R=O,(!w||w.length>0)&&(w=[]),k=null;return I()}decodeMultiple(e,t){let n,r=0;try{let o=e.length;C=!0;let i=this?this.decode(e,o):se.decode(e,o);if(!t){for(n=[i];y<o;)r=y,n.push(I());return n}if(!1===t(i))return;for(;y<o;)if(r=y,!1===t(I()))return}catch(e){throw e.lastPosition=r,e.values=n,e}finally{C=!1,ie()}}}function I(){try{let e=j();if(v){if(y>=v.postBundlePosition){let e=new Error("Unexpected bundle position");throw e.incomplete=!0,e}y=v.postBundlePosition,v=null}if(y==h)w=null,p=null,b&&(b=null);else{if(y>h){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}if(!C)throw new Error("Data read, but end of buffer not reached")}return e}catch(e){throw ie(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer"))&&(e.incomplete=!0),e}}function j(){let e=p[y++],t=e>>5;if(e&=31,e>23)switch(e){case 24:e=p[y++];break;case 25:if(7==t)return function(){let e=p[y++],t=p[y++],n=(127&e)>>2;if(31===n)return t||3&e?NaN:128&e?-1/0:1/0;if(0===n){let n=((3&e)<<8|t)/(1<<24);return 128&e?-n:n}return W[3]=128&e|56+(n>>1),W[2]=(7&e)<<5|t>>3,W[1]=t<<5,W[0]=0,V[0]}();e=x.getUint16(y),y+=2;break;case 26:if(7==t){let e=x.getFloat32(y);if(R.useFloat32>2){let t=ae[(127&p[y])<<1|p[y+1]>>7];return y+=4,(t*e+(e>0?.5:-.5)|0)/t}return y+=4,e}e=x.getUint32(y),y+=4;break;case 27:if(7==t){let e=x.getFloat64(y);return y+=8,e}if(t>1){if(x.getUint32(y)>0)throw new Error("JavaScript does not support arrays, maps, or strings with length over 4294967295");e=x.getUint32(y+4)}else R.int64AsNumber?(e=4294967296*x.getUint32(y),e+=x.getUint32(y+4)):e=x.getBigUint64(y);y+=8;break;case 31:switch(t){case 2:case 3:throw new Error("Indefinite length not supported for byte or text strings");case 4:let e,n=[],r=0;for(;(e=j())!=m;){if(r>=T)throw new Error("Array length exceeds 112810000");n[r++]=e}return 4==t?n:3==t?n.join(""):Buffer.concat(n);case 5:let o;if(R.mapsAsObjects){let e={},t=0;if(R.keyMap)for(;(o=j())!=m;){if(t++>=A)throw new Error("Property count exceeds 16810000");e[D(R.decodeKey(o))]=j()}else for(;(o=j())!=m;){if(t++>=A)throw new Error("Property count exceeds 16810000");e[D(o)]=j()}return e}{E&&(R.mapsAsObjects=!0,E=!1);let e=new Map;if(R.keyMap){let t=0;for(;(o=j())!=m;){if(t++>=A)throw new Error("Map size exceeds 16810000");e.set(R.decodeKey(o),j())}}else{let t=0;for(;(o=j())!=m;){if(t++>=A)throw new Error("Map size exceeds 16810000");e.set(o,j())}}return e}case 7:return m;default:throw new Error("Invalid major type for indefinite length "+t)}default:throw new Error("Unknown token "+e)}switch(t){case 0:return e;case 1:return~e;case 2:return n=e,R.copyBuffers?Uint8Array.prototype.slice.call(p,y,y+=n):p.subarray(y,y+=n);case 3:if(U>=y)return g.slice(y-S,(y+=e)-S);if(0==U&&h<140&&e<32){let t=e<16?K(e):function(e){let t=y,n=new Array(e);for(let r=0;r<e;r++){const e=p[y++];if((128&e)>0)return void(y=t);n[r]=e}return F.apply(String,n)}(e);if(null!=t)return t}return $(e);case 4:if(e>=T)throw new Error("Array length exceeds 112810000");let t=new Array(e);for(let n=0;n<e;n++)t[n]=j();return t;case 5:if(e>=A)throw new Error("Map size exceeds 112810000");if(R.mapsAsObjects){let t={};if(R.keyMap)for(let n=0;n<e;n++)t[D(R.decodeKey(j()))]=j();else for(let n=0;n<e;n++)t[D(j())]=j();return t}{E&&(R.mapsAsObjects=!0,E=!1);let t=new Map;if(R.keyMap)for(let n=0;n<e;n++)t.set(R.decodeKey(j()),j());else for(let n=0;n<e;n++)t.set(j(),j());return t}case 6:if(e>=57337){let t=w[8191&e];if(t)return t.read||(t.read=N(t)),t.read();if(e<65536){if(57343==e){let e=ne(),t=j(),n=j();q(t,n);let r={};if(R.keyMap)for(let t=2;t<e;t++)r[D(R.decodeKey(n[t-2]))]=j();else for(let t=2;t<e;t++)r[D(n[t-2])]=j();return r}if(57342==e){let e=ne(),t=j();for(let n=2;n<e;n++)q(t++,j());return j()}if(57337==e)return function(){let e=ne(),t=y+j();for(let t=2;t<e;t++){let e=ne();y+=e}let n=y;return y=t,v=[z(ne()),z(ne())],v.position0=0,v.position1=0,v.postBundlePosition=y,y=n,j()}();if(R.getShared&&(re(),t=w[8191&e],t))return t.read||(t.read=N(t)),t.read()}}let r=_[e];if(r)return r.handlesRead?r(j):r(j());{let t=j();for(let n=0;n<P.length;n++){let r=P[n](e,t);if(void 0!==r)return r}return new H(t,e)}case 7:switch(e){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;default:let t=(k||G())[e];if(void 0!==t)return t;throw new Error("Unknown token "+e)}default:if(isNaN(e)){let e=new Error("Unexpected end of CBOR data");throw e.incomplete=!0,e}throw new Error("Unknown CBOR token "+e)}var n}const B=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function N(e){if(!e)throw new Error("Structure is required in record definition");return e.slowReads=0,function(){let e=p[y++];if(e&=31,e>23)switch(e){case 24:e=p[y++];break;case 25:e=x.getUint16(y),y+=2;break;case 26:e=x.getUint32(y),y+=4;break;default:throw new Error("Expected array header, but got "+p[y-1])}let t=this.compiledReader;for(;t;){if(t.propertyCount===e)return t(j);t=t.next}if(this.slowReads++>=M){let n=this.length==e?this:this.slice(0,e);return t=R.keyMap?new Function("r","return {"+n.map((e=>R.decodeKey(e))).map((e=>B.test(e)?D(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"):new Function("r","return {"+n.map((e=>B.test(e)?D(e)+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}"),this.compiledReader&&(t.next=this.compiledReader),t.propertyCount=e,this.compiledReader=t,t(j)}let n={};if(R.keyMap)for(let t=0;t<e;t++)n[D(R.decodeKey(this[t]))]=j();else for(let t=0;t<e;t++)n[D(this[t])]=j();return n}}function D(e){if("string"==typeof e)return"__proto__"===e?"__proto_":e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";throw new Error("Invalid property name type "+typeof e)}let $=z;function z(e){let t;if(e<16&&(t=K(e)))return t;if(e>64&&f)return f.decode(p.subarray(y,y+=e));const n=y+e,r=[];for(t="";y<n;){const e=p[y++];if(128&e)if(192==(224&e)){const t=63&p[y++];r.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&p[y++],n=63&p[y++];r.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&p[y++])<<12|(63&p[y++])<<6|63&p[y++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}else r.push(e);else r.push(e);r.length>=4096&&(t+=F.apply(String,r),r.length=0)}return r.length>0&&(t+=F.apply(String,r)),t}let F=String.fromCharCode;function K(e){if(e<4){if(e<2){if(0===e)return"";{let e=p[y++];return(128&e)>1?void(y-=1):F(e)}}{let t=p[y++],n=p[y++];if((128&t)>0||(128&n)>0)return void(y-=2);if(e<3)return F(t,n);let r=p[y++];return(128&r)>0?void(y-=3):F(t,n,r)}}{let t=p[y++],n=p[y++],r=p[y++],o=p[y++];if((128&t)>0||(128&n)>0||(128&r)>0||(128&o)>0)return void(y-=4);if(e<6){if(4===e)return F(t,n,r,o);{let e=p[y++];return(128&e)>0?void(y-=5):F(t,n,r,o,e)}}if(e<8){let i=p[y++],a=p[y++];if((128&i)>0||(128&a)>0)return void(y-=6);if(e<7)return F(t,n,r,o,i,a);let s=p[y++];return(128&s)>0?void(y-=7):F(t,n,r,o,i,a,s)}{let i=p[y++],a=p[y++],s=p[y++],c=p[y++];if((128&i)>0||(128&a)>0||(128&s)>0||(128&c)>0)return void(y-=8);if(e<10){if(8===e)return F(t,n,r,o,i,a,s,c);{let e=p[y++];return(128&e)>0?void(y-=9):F(t,n,r,o,i,a,s,c,e)}}if(e<12){let l=p[y++],u=p[y++];if((128&l)>0||(128&u)>0)return void(y-=10);if(e<11)return F(t,n,r,o,i,a,s,c,l,u);let d=p[y++];return(128&d)>0?void(y-=11):F(t,n,r,o,i,a,s,c,l,u,d)}{let l=p[y++],u=p[y++],d=p[y++],f=p[y++];if((128&l)>0||(128&u)>0||(128&d)>0||(128&f)>0)return void(y-=12);if(e<14){if(12===e)return F(t,n,r,o,i,a,s,c,l,u,d,f);{let e=p[y++];return(128&e)>0?void(y-=13):F(t,n,r,o,i,a,s,c,l,u,d,f,e)}}{let h=p[y++],m=p[y++];if((128&h)>0||(128&m)>0)return void(y-=14);if(e<15)return F(t,n,r,o,i,a,s,c,l,u,d,f,h,m);let w=p[y++];return(128&w)>0?void(y-=15):F(t,n,r,o,i,a,s,c,l,u,d,f,h,m,w)}}}}}let V=new Float32Array(1),W=new Uint8Array(V.buffer,0,4);new Array(4096);class H{constructor(e,t){this.value=e,this.tag=t}}_[0]=e=>new Date(e),_[1]=e=>new Date(Math.round(1e3*e)),_[2]=e=>{let t=BigInt(0);for(let n=0,r=e.byteLength;n<r;n++)t=BigInt(e[n])+(t<<BigInt(8));return t},_[3]=e=>BigInt(-1)-_[2](e),_[4]=e=>+(e[1]+"e"+e[0]),_[5]=e=>e[1]*Math.exp(e[0]*Math.log(2));const q=(e,t)=>{let n=w[e-=57344];n&&n.isShared&&((w.restoreStructures||(w.restoreStructures=[]))[e]=n),w[e]=t,t.read=N(t)};_[105]=e=>{let t=e.length,n=e[1];q(e[0],n);let r={};for(let o=2;o<t;o++)r[D(n[o-2])]=e[o];return r},_[14]=e=>v?v[0].slice(v.position0,v.position0+=e):new H(e,14),_[15]=e=>v?v[1].slice(v.position1,v.position1+=e):new H(e,15);let J={Error:Error,RegExp:RegExp};_[27]=e=>(J[e[0]]||Error)(e[1],e[2]);const Y=e=>{if(132!=p[y++]){let e=new Error("Packed values structure must be followed by a 4 element array");throw p.length<y&&(e.incomplete=!0),e}let t=e();if(!t||!t.length){let e=new Error("Packed values structure must be followed by a 4 element array");throw e.incomplete=!0,e}return k=k?t.concat(k.slice(t.length)):t,k.prefixes=e(),k.suffixes=e(),e()};function X(e,t){return"string"==typeof e?e+t:e instanceof Array?e.concat(t):Object.assign({},e,t)}function G(){if(!k){if(!R.getShared)throw new Error("No packed values available");re()}return k}Y.handlesRead=!0,_[51]=Y,_[6]=e=>{if(!k){if(!R.getShared)return new H(e,6);re()}if("number"==typeof e)return k[16+(e>=0?2*e:-2*e-1)];let t=new Error("No support for non-integer packed references yet");throw void 0===e&&(t.incomplete=!0),t},_[28]=e=>{b||(b=new Map,b.id=0);let t,n=b.id++,r=y;t=p[y]>>5==4?[]:{};let o={target:t};b.set(n,o);let i=e();return o.used?(Object.getPrototypeOf(t)!==Object.getPrototypeOf(i)&&(y=r,t=i,b.set(n,{target:t}),i=e()),Object.assign(t,i)):(o.target=i,i)},_[28].handlesRead=!0,_[29]=e=>{let t=b.get(e);return t.used=!0,t.target},_[258]=e=>new Set(e),(_[259]=e=>(R.mapsAsObjects&&(R.mapsAsObjects=!1,E=!0),e())).handlesRead=!0,P.push(((e,t)=>e>=225&&e<=255?X(G().prefixes[e-224],t):e>=28704&&e<=32767?X(G().prefixes[e-28672],t):e>=1879052288&&e<=2147483647?X(G().prefixes[e-1879048192],t):e>=216&&e<=223?X(t,G().suffixes[e-216]):e>=27647&&e<=28671?X(t,G().suffixes[e-27639]):e>=1811940352&&e<=1879048191?X(t,G().suffixes[e-1811939328]):1399353956==e?{packedValues:k,structures:w.slice(0),version:t}:55799==e?t:void 0));const Z=1==new Uint8Array(new Uint16Array([1]).buffer)[0],Q=[Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,"undefined"==typeof BigUint64Array?{name:"BigUint64Array"}:BigUint64Array,Int8Array,Int16Array,Int32Array,"undefined"==typeof BigInt64Array?{name:"BigInt64Array"}:BigInt64Array,Float32Array,Float64Array],ee=[64,68,69,70,71,72,77,78,79,85,86];for(let e=0;e<Q.length;e++)te(Q[e],ee[e]);function te(e,t){let n,r="get"+e.name.slice(0,-5);if("function"==typeof e){n=e.BYTES_PER_ELEMENT;for(let o=0;o<2;o++){if(!o&&1==n)continue;let i=2==n?1:4==n?2:8==n?3:0;_[o?t:t-4]=1==n||o==Z?r=>{if(!e)throw new Error("Could not find typed array for code "+t);return R.copyBuffers||1!==n&&(2!==n||1&r.byteOffset)&&(4!==n||3&r.byteOffset)&&(8!==n||7&r.byteOffset)?new e(Uint8Array.prototype.slice.call(r,0).buffer):new e(r.buffer,r.byteOffset,r.byteLength>>i)}:n=>{if(!e)throw new Error("Could not find typed array for code "+t);let a=new DataView(n.buffer,n.byteOffset,n.byteLength),s=n.length>>i,c=new e(s),l=a[r];for(let e=0;e<s;e++)c[e]=l.call(a,e<<i,o);return c}}}}function ne(){let e=31&p[y++];if(e>23)switch(e){case 24:e=p[y++];break;case 25:e=x.getUint16(y),y+=2;break;case 26:e=x.getUint32(y),y+=4}return e}function re(){if(R.getShared){let e=oe((()=>(p=null,R.getShared())))||{},t=e.structures||[];R.sharedVersion=e.version,k=R.sharedValues=e.packedValues,!0===w?R.structures=w=t:w.splice.apply(w,[0,t.length].concat(t))}}function oe(e){let t=h,n=y,r=S,o=U,i=g,a=b,s=v,c=new Uint8Array(p.slice(0,h)),l=w,u=R,d=C,f=e();return h=t,y=n,S=r,U=o,g=i,b=a,v=s,p=c,C=d,w=l,R=u,x=new DataView(p.buffer,p.byteOffset,p.byteLength),f}function ie(){p=null,b=null,w=null}const ae=new Array(147);for(let e=0;e<256;e++)ae[e]=+("1e"+Math.floor(45.15-.30103*e));let se=new L({useRecords:!1});const ce=se.decode;se.decodeMultiple;var le={0:11,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10,";":39," ":57,"-":12,",":51,".":52,"'":40,"[":26,"]":27,"*":55,"/":53,"\\":43,"=":13,a:30,Alt:56,ArrowDown:108,ArrowLeft:105,ArrowRight:106,ArrowUp:103,b:48,Backspace:14,c:46,Control:29,d:32,Delete:111,e:18,End:107,Enter:28,Escape:1,f:33,g:34,h:35,Home:102,i:23,j:36,k:37,l:38,m:50,n:49,o:24,p:25,PageDown:109,PageUp:104,q:16,r:19,RShift:54,s:31,Shift:42,t:20,Tab:15,u:22,v:47,w:17,x:45,y:21,"+":78,z:44},ue={_:12,":":39,"?":53,'"':40,"!":2,"{":26,"}":27,"@":3,"*":9,"&":8,"#":4,"%":6,">":52,"|":43,"(":10,")":11,"/":98,"^":7,"+":13,"<":51,"=":117,$:5};const{userAgent:de}=navigator,fe=(()=>{if(de.includes("Windows"))return 1;if(de.includes("Mac"))return"ontouchend"in document?7:2;if(de.includes("CrOS"))return 4;if(de.includes("Android"))return 3;if(de.includes("Linux"))return 0;const{platform:e}=navigator;return e.startsWith("iP")?e.startsWith("iPad")?7:6:5})(),pe=/^((?!chrome|android).)*safari/i.test(de),he=de.includes("Mobile"),ye=de.includes("Tablet"),me=de.includes("Firefox")&&(he||ye),we=["EMERG","ALERT","CRIT","ERR","WARNING","NOTICE","INFO","DEBUG"];function ge(e,t,n){const r=`[Hyperbeam(${He}):${we[e]}] ${n?`${t} | ${n}`:t}`;switch(e){case 0:case 1:case 2:case 3:console.error(r);break;case 4:console.warn(r);break;case 5:case 6:console.info(r);break;case 7:console.debug(r)}}const ve=[.25,.5,.5,.75],be={forceRequestControlBoxClose:!0,vmConn:4,needInteraction:!1,forceTURN:!1,haveVM:!0,codecErr:!1},ke="peer_mouse",{parent:xe}=window;function Ee(e,t){xe!==window&&xe.postMessage(e,"*",t)}let Te;const Ae={data:[],i:0};let Re=0;function Se(e){switch(Re){case 0:return e>8?1:0;case 1:return e<6?0:1}return Re=0,0}const Ue=2e-4;let _e,Pe=0;function Oe(e){let t=0;switch(Pe){case 0:t=e>.015?2:e>.003?1:0;break;case 1:t=e>.015?2:e<Ue?0:1;break;case 2:t=e<Ue?0:e<.001?1:2}return Pe=t,t}let Ce,Me,Le,Ie,je,Be,Ne=0,De=0,$e=0,ze=!1,Fe=!0,Ke=0;function Ve(e,t){null==e||e({type:"rtt",data:Math.round(1e3*t)})}function We(){Te&&(clearInterval(Te),Te=void 0,Ae.data.length=Ae.i=0)}let He="";function qe(e,t=location.href,r,o){const i=new URL(t);He=i.pathname.slice(1);const{searchParams:a}=i,s=e||document;let c=!1!==(null==o?void 0:o.delegateKeyboard),l=!0===(null==o?void 0:o.disableInput);const u=null==o?void 0:o.persistScreen,d=null==o?void 0:o.frameCb,f=null==o?void 0:o.audioTrackCb,p=null==o?void 0:o.videoTrackCb,h=document.createElement("template");let y;h.innerHTML='<svg id="progress" width="120" height="120" style="filter:drop-shadow(2px 4px 6px black);pointer-events:none;position:absolute;z-index:2"><circle id="circle" stroke="white" stroke-width="4" stroke-dasharray="364.424747816416 364.424747816416" stroke-dashoffset="364.424747816416" fill="transparent" r="58" cx="60" cy="60" style="transform-origin:50% 50%;transform:rotate(-90deg);transition:.35s stroke-dashoffset"/><polygon id="play" stroke="white" fill="white" points="42.68,30 94.64,60 42.68,90" style="display:none"/></svg><input type="text" id="text" autocomplete="off" autocapitalize="off" style="appearance:none;box-shadow:0 4px 10px rgba(0,0,0,.4);border:0;border-radius:2px;color:#fff;cursor:inherit;outline:0;padding:0;position:absolute;width:300px">';const m="align-items:center;background-position:center center;background-repeat:no-repeat;background-size:contain;display:flex;height:100%;justify-content:center;margin:0;overflow:hidden;overflow:clip;width:100%";let w,g;if(e){const t=s.getElementById("root");t?(g=s.getElementById("canvas"),t.style.cssText=m,g&&(g.style.filter="blur(5px)",t.childElementCount>1&&(ge(3,"found instance leak, hb.destroy() must be called before reusing div; proceeding dangerously."),t.innerHTML=""),t.appendChild(g),w=g),y=t):(y=document.createElement("div"),y.id="root",y.style.cssText=m),e.appendChild(y)}else{const e=document.documentElement.style;e.width=e.height="100%",y=document.body,y.style.touchAction=e.touchAction="none",y.style.cssText=m,r=Ee}g||(w=document.createElement("canvas"),w.id="canvas",w.style.cssText="display:none;height:100%;object-fit:contain;pointer-events:none;position:absolute;width:100%",y.appendChild(w)),y.appendChild(h.content);const v=s.getElementById("text"),b={backgroundColor:"transparent",caretColor:"transparent",fontSize:"100%",height:"100%",maxWidth:"",pointerEvents:"",textAlign:"center",visibility:"",width:"100%"},k={backgroundColor:"",caretColor:"",fontSize:"",height:"",maxWidth:"80%",pointerEvents:"none",textAlign:"",visibility:"hidden",width:"300px"},x={backgroundColor:"rgba(0,0,0,.4)",caretColor:"",fontSize:"36px",height:"",maxWidth:"80%",pointerEvents:"none",textAlign:"",visibility:"",width:"300px"};Object.assign(v.style,k);const E=document.createElement("video");E.autoplay=!0,E.playsInline=!0,E.id="vid",E.style.cssText="display:block;height:0;width:100%",y.insertBefore(E,v);const T=E.canPlayType('video/mp4; codecs="avc1.42e01f"'),A=le,R=ue,S="undefined"!=typeof MediaStreamTrackProcessor,U=!(p||d&&S),_="copy",P="release",O="force_turn",C=e=>(e.stopPropagation(),!1);E.oncontextmenu=C;let M=!0;{let e=!1;if(E.addEventListener("click",C,{get signal(){e=!0}}),E.removeEventListener("click",C),!e){const e=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,n,r){return"object"==typeof r&&r.signal&&r.signal.addEventListener("abort",(()=>{this.removeEventListener(t,n,{...r})}),{once:!0}),e.call(this,t,n,r)}}}const L=new AbortController;function I(e,t,n=!1){addEventListener(e,t,{signal:L.signal,capture:n})}function j(){setTimeout(Rt,0,P,{all:!1})}function B(){Rt(P,{all:!0})}I("mousedown",oe),I("mousemove",oe),I("mouseout",oe),I("mouseup",oe),I("contextmenu",B);const{parent:N}=window;N===window?(I("pagehide",B),I("blur",B)):e||I("message",(({data:e})=>{Dt(e)})),I("online",(function(){6===be.vmConn&&Pt()}));let D=!1;function $(){if(!D){D=!0,E.addEventListener("touchstart",oe,{signal:L.signal});for(const e of["touchmove","touchend","touchcancel"])E.addEventListener(e,oe,{passive:!0,signal:L.signal})}}7===fe&&$(),E.addEventListener("wheel",oe,{signal:L.signal}),I("keydown",oe),I("keyup",oe);const z=[];function F(e){for(let t=0;t<z.length;t++)if(z[t]===e)return t}function K({touches:e,changedTouches:t}){if(0===e.length)z.fill(void 0);else for(const{identifier:e}of t){const t=F(e);null!=t&&(z[t]=void 0)}}I("touchstart",(function({touches:e,changedTouches:t}){1===e.length&&z.fill(void 0);e:for(const{identifier:e}of t){for(let t=0;t<z.length;t++)if(null==z[t]){z[t]=e;continue e}z.push(e)}}),!0),I("touchend",K),I("touchcancel",K);const V=s.getElementById("progress"),W=s.getElementById("play");function H(){v!==s.activeElement&&(v.value="",Object.assign(v.style,b)),v.focus()}function q(){if(e){if(c||j(),v!==s.activeElement)return;v.blur()}else{if(v!==document.activeElement)return;v.blur(),N!==window&&N.focus()}clearTimeout(J),J=void 0,v.value="",Object.assign(v.style,k)}let J,Y;function X(e){J=setTimeout((()=>{J=void 0,v.value=""}),e)}function G(e,t,n,r){const o="Control";let i=!1;2===fe&&("Meta"===e?e=o:n&&(t=!0,i=!0)),e===o&&(t=!1);do{let n;const o=1===[...e].length;if(t){if("c"===e||"x"===e)return void(r&&(n=getSelection(),n&&"Range"===n.type||Rt("c"===e?_:"cut",{admin_token:Lt})));o&&(e=e.toLowerCase())}if(e in A)break;if(o){const t=e.charCodeAt(0);if(t<=127&&(t>64&&t<91||e in R))break;r&&(Q=e,we(e))}return}while(0);Rt(r?"k":"K",{k:e}),i&&Rt("K",{k:e})}function Z(e,t,n){let{x:r,y:o,width:i,height:a}=e;return i*=lt/dt,a*=ut/ft,[(t-r)/i,(n-o)/a]}v.addEventListener("wheel",oe,{signal:L.signal}),v.addEventListener("compositionstart",(e=>{j(),Object.assign(v.style,x)}),{signal:L.signal}),v.addEventListener("compositionend",(({data:e})=>{e&&we(e),clearTimeout(J),X(),Object.assign(v.style,b)}),{signal:L.signal}),v.addEventListener("paste",(({clipboardData:e})=>{const t=null==e?void 0:e.getData("text/plain");t&&Rt("s",{s:t})}),{signal:L.signal}),v.addEventListener("blur",q,{signal:L.signal}),v.addEventListener("beforeinput",(e=>{switch(e.inputType){case"insertText":{const{data:t}=e;(re||t!==Q)&&t&&we(t),re||(me?(clearTimeout(J),X(100)):e.preventDefault()),re=!1;break}case"deleteContentBackward":J&&(clearTimeout(J),J=void 0,he.pop());break;default:e.preventDefault()}}));let Q,ee=!1,te=!1,ne=!1,re=!1;function oe(t){let{type:n}=t;if("keydown"===n&&(2===fe?t.metaKey:t.ctrlKey)&&"v"===t.key)return;if(e||t.currentTarget===E||(t.preventDefault(),t.stopPropagation()),["mousemove","touchmove"].includes(n)){if(At())return}else if(["mousedown","touchstart"].includes(n)){if(e||null==r||r({type:"blur"}),be.needInteraction)return f||(E.muted=!1,E.play().catch((()=>{}))),E.style.filter="",V.style.display="none",Qe.style.fill="",W.style.display="none",be.needInteraction=!1,4===be.vmConn&&Pt(),void $()}else if(be.needInteraction)return;if(5!==be.vmConn||l)return;let o=!1;switch(n){case"keydown":if(null==Y||Y(),o=!0,t.repeat)return;case"keyup":if(e){const e=t.composedPath()[0];if(e!==v){if(!c)return;if(o&&e&&("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName||e.isContentEditable))return}else"Tab"===t.key&&t.preventDefault()}if(!t.isComposing){let{key:e,keyCode:n,location:r}=t;if(o&&t.ctrlKey&&"o"===e&&t.preventDefault(),229===n)return void(o?re=!0:(clearTimeout(J),me?X(100):(v.value="",J=void 0)));re=!1,o&&(Q=1===e.length?e:void 0),"Shift"===e&&2===r&&(e="RShift"),G(e,t.ctrlKey,t.metaKey,o)}return;case"wheel":case"mousedown":null==Y||Y();case"mouseup":case"mousemove":case"mouseout":{if(d||p)return;const e="mouseout"===n,r="mousemove"===n||e,o="mouseup"===n,i=t.buttons>0,a=ee&&(o||r&&i)||r&&te,s=t.composedPath()[0];let c,l,u;const f=te=!e&&(s===E||s===v&&(c=E.getBoundingClientRect(),({clientX:l,clientY:u}=t),l>=c.left&&l<=c.right&&u>=c.top&&u<=c.bottom&&("mousedown"===n?M&&(M=!1,v.oncontextmenu=C):!M&&(M=!0,v.oncontextmenu=null),!0))),h=f?0:-1;if(a||f){let[e,s]=Z(c||E.getBoundingClientRect(),t.clientX,t.clientY);if(e<0){if(!a)return;e=h}else if(e>1){if(!a)return;e=1}else e=ie(e,lt,h);if(s<0){if(!a)return;s=h}else if(s>1){if(!a)return;s=1}else s=ie(s,ut,h);"wheel"===n?f&&(t.preventDefault(),Rt("w",{axis:0,diff:~~t.deltaY})):(f&&o&&(_t?Ct():jt&&H()),i?"mousedown"===n&&(ee=!0):ee=!1,1===t.button&&o&&t.preventDefault(),de(ae[n],e,s,r?void 0:t.button))}return}case"touchstart":t.preventDefault(),M||(M=!0,v.oncontextmenu=null);case"touchmove":null==Y||Y();case"touchend":case"touchcancel":{const{touches:e,changedTouches:r}=t;if(r.length>0){const e=[];for(const t of r){const n=F(t.identifier);null!=n&&e.push([n,t])}e.sort(((e,t)=>e[0]-t[0]));const t=E.getBoundingClientRect();for(const[r,o]of e){const[e,i]=Z(t,o.clientX,o.clientY);Rt(ae[n],{i:r,x:+e.toFixed(4),y:+i.toFixed(4)})}}return(0===e.length&&"touchend"===n||"touchcancel"===n)&&ne&&"touchend"===n&&(_t?Ct():jt&&H()),void(ne="touchstart"===n&&1===e.length)}}}const ie=(e,t,n)=>e*t<1.5?n:(1-e)*t<1.5?1:e,ae={mousemove:"",mousedown:"m",mouseup:"M",touchstart:"t",touchmove:"y",touchend:"T",touchcancel:"T"},se=[0,2,1];function de(e,t,n,r){let o;null!=r&&null==(o=se[r])||Rt(e,{x:+t.toFixed(4),y:+n.toFixed(4),b:o})}const he=[];let ye;function we(e){he.push(e),clearTimeout(ye),ye=setTimeout(xe)}function xe(){Rt("s",{s:he.join("")}),he.length=0}let Re=!1,Ue=0;const Pe="jitterBufferTarget"in RTCRtpReceiver.prototype;function qe(e){if(!Re||ct()||e===Ue)return;Ue=e;const t=1.1*e;for(const e of it.getReceivers())e.track.muted||(Pe?e.jitterBufferTarget=1e3*t:e.playoutDelayHint=t)}let Je,Ye=!1;function Xe(){const e=Je;return Je=new Date,e?Je.getTime()-e.getTime():0}function Ge(e,t){Rt(e,Math.floor(t))}let Ze=!1;document.addEventListener("visibilitychange",(function(){document.hidden!==Ze&&(document.hidden?(B(),Ze=!0):Ze=!1)}),{signal:L.signal});const Qe=s.getElementById("circle"),et=2*Math.PI*58;function tt(e){const t=et*(1-e);Qe.style.strokeDashoffset=""+t}function nt(e){ge(6,"connectionState",`state = ${e}`),null==r||r({type:"connection_state",data:{state:e}})}function rt(e){switch(be.vmConn=e,tt(ve[e]||1),e){case 0:Ye=!1,be.forceTURN&&Ge(O,1),Xe(),nt("connecting");break;case 1:case 3:Ye||Ge(1===e?"init":"conn",Xe());break;case 2:nt("reconnecting");break;case 5:return Ye||Ge("buff",Xe()),Ye=!0,void nt("playing")}}let ot,it,at,st;function ct(){return!it||"closed"===it.iceConnectionState}let lt=0,ut=0,dt=0,ft=0,pt=24;const ht="objectViewBox"in E.style;function yt({width:e,height:t}){if(!(lt&&ut&&e&&t&&5===be.vmConn))return;const n=lt/ut,r=e/t,o=Math.abs(n-r)<.001,{style:i}=E;if(ht){i.width=o||r<n?"100%":"auto",i.height=!o&&r>n?"100%":"auto";const e=dt-lt,t=ft-ut;i.objectViewBox=e&&t?`inset(0% ${100*e/dt}% ${100*t/ft}% 0%)`:""}else{if(dt>lt){!o&&r>n&&(e=t*n);const a=(dt/lt-1)*e+"px";i.width=o||r<n?`calc(${a} + 100%)`:"auto",i.marginRight="-"+a}else i.width=o||r<n?"100%":"auto",i.marginRight="";if(ft>ut){!o&&r<n&&(t=e/n);const a=(ft/ut-1)*t+"px";i.height=!o&&r>n?`calc(${a} + 100%)`:"auto",i.marginBottom="-"+a}else i.height=!o&&r>n?"100%":"auto",i.marginBottom=""}}let mt,wt,gt;function vt(){clearTimeout(wt),wt=setTimeout((()=>{St(),kt()}),2e3)}"undefined"!=typeof ResizeObserver&&(mt=new ResizeObserver((([{contentRect:e}])=>{yt(e)}))).observe(y);const bt=a.get("token");async function kt(e){if(e){if(bt)return;gt=e}rt(0);let t=3;for(;;){const e={};at&&(e.user_token=at),gt?gt.webhookUserdata&&(e.userdata=encodeURIComponent(JSON.stringify(gt.webhookUserdata))):e.token=bt||"";const n=new URLSearchParams(e).toString();let r=i.origin.replace("http","ws")+i.pathname;n&&(r+="?"+n),ot=new WebSocket(r),ot.binaryType="arraybuffer";try{ot.readyState!==WebSocket.OPEN&&await new Promise(((e,t)=>{ot.onopen=e,ot.onerror=t})),ot.onopen=null,ot.onerror=null,ot.onmessage=Ot,ot.onclose=xt;for(const e of Et)ot.send(e);Et.length=0;break}catch(e){if(ot.onopen=null,ot.onerror=null,St(),!(navigator.onLine&&t-- >0)){be.vmConn=6;break}await new Promise((e=>setTimeout(e,1e3)))}}}function xt({code:e,reason:t}){if(ot)if(ot=void 0,[1e3,1008,1011,4001].includes(e)){if(Nt(),rt(4),4001===e){const n=document.createElement("h1");n.style.cssText="color:#fff;position:absolute;text-transform:uppercase",n.textContent=`${e}: ${t}`,y.appendChild(n),t="unauthorized"}else t=t||"unknown";ge(4,"disconnect",`reason = ${t}`),null==r||r({type:"disconnect",data:{type:t}})}else Nt(!0),V.style.display="",rt(2),kt()}const Et=[];function Tt(e){ot&&(ot.readyState!==WebSocket.OPEN?Et.push(e):ot.send(e))}function At(){let e=0;const t=Date.now();return(t-e)*pt<1e3||(e=t,!1)}function Rt(e,t){Tt(JSON.stringify({type:e,data:t}))}function St(){ot&&(ot.onmessage=ot.onerror=ot.onclose=null,ot.close())}let Ut,_t;function Pt(e="auto"){ge(4,"reconnect",`reason = ${e}`),be.haveVM&&(Nt(!0),V.style.display="",rt(2),Rt("reconnect",{reason:e}),vt()),We()}async function Ot({data:t}){var a;const s=t.constructor===ArrayBuffer?new Uint8Array(t):void 0,c=s?ce(s):JSON.parse(t);if("i"in c)return void(null==r||r(c));let{type:l,data:u}=c;switch(l){case"new":{const{id:x,token:A,maxArea:R,offer:P}=u;at=A,A&&(null===(a=null==o?void 0:o.onUserToken)||void 0===a||a.call(o,A)),st=u.turn,lt=u.width,ut=u.height,dt=u.rwidth,ft=u.rheight,pt=u.fps,E.style.marginBottom=ut/lt*100+"%",T||(be.codecErr=!0),rt(1),vt(),null==r||r({type:"connection",data:{user_id:x,width:lt,height:ut,max_area:R}}),Rt("hostname",e?location.hostname:N===window?void 0:document.referrer?new URL(document.referrer).hostname:void 0),u=P}case"offer":{if(!be.haveVM)break;let C,M;clearTimeout(wt);{function B(e,t){let n,r;return e.map((e=>([n,r]=e.split("/"),`turn${"tls"===n?(n="tcp","s"):""}:${t}:${r}?transport=${n}`)))}if(st){let{hostname:D,username:z,credential:F,ports:K}=st;st.force&&(M="relay"),C=(D instanceof Array?D:[D]).map((e=>({username:z,credential:F,urls:B(K,e)})))}else{const{hostname:W}=i;C=[{username:"a",credential:"a",urls:B(["udp/80","udp/3478","tcp/80","tcp/3478","tls/443","tls/5349"],W)}],be.forceTURN&&(M="relay")}}it=new RTCPeerConnection({iceServers:C,iceTransportPolicy:M}),await it.setRemoteDescription({type:"offer",sdp:u});const L=await it.createAnswer();let I,{sdp:j}=L;j&&(j=L.sdp=j.replace(/a=fmtp:101 (((?!stereo=1;|;stereo=1).)*\r?\n)/,"a=fmtp:101 stereo=1;$1")),Rt("answer",j),await it.setLocalDescription(L),it.addEventListener("iceconnectionstatechange",(async()=>{if(!it)return;const e=it.iceConnectionState;switch(console.log("ice connection state change:",e),e){case"connected":if(null!=I&&(clearTimeout(I),I=void 0),!ot)break;try{const e=()=>Rt("keyframe");!function(e,t,n,r,o){Ce=Ne,Le=$e,Me=De,Be=Ke,Ne=0,$e=0,De=0,Ke=0,_e=0,je=0,Te=setInterval((async()=>{if("closed"===e.connectionState)return void We();let i,a,s,c,l,u,d;try{i=await e.getStats()}catch(e){return console.error("getStats failed",e),void We()}for(const[e,t]of i)if("candidate-pair"===t.type){d=t.currentRoundTripTime;break}if(null!=d?(Fe=!1,Ve(n,d)):(Fe=!0,d=Ie),null!=d&&d>2)t("behind");else for(const[e,n]of i)if("video"===n.kind&&"ssrc"in n&&1234!==n.ssrc){a=n.packetsLost;let e=n.packetsReceived;if(null!=a&&null!=e){if(a+=Ce,e+=Le,s=a+e,c=n.framesDropped,l=n.framesReceived,u=n.framesDecoded,null!=c&&null!=l&&null!=u){if(c+=Me,l+=Be,c>De)a>Ne&&!ze&&(ze=!0,o()),je=0;else if(u>_e)je=0,ze=!1;else if(e>$e){if(je+=400,je>=6e3)return void t();je>=1e3&&(ze||(ze=!0,o()))}De=c,Ke=l,_e=u;const i={droppedPackets:a,totalPackets:s,droppedFrames:c,totalFrames:l,jitter:n.jitter,roundTripTime:d},{data:f,i:p}=Ae;f[p]=i,Ae.i=(p+1)%40;const h=f.length;if(3===be.vmConn&&400*h>=6e3&&!be.forceTURN&&!(s/a>10))return be.forceTURN=!0,t(),void ge(4,"Force TURN","case 1");if(h>=20){let e=0,t=0;for(const{roundTripTime:n}of f)n&&(e+=n,t++);if(t){let n=(p+h-19)%h;const o=f[n],i=s-o.totalPackets,c=e/t,l=Oe(i&&(a-o.droppedPackets)/i);let u=0,d=0;for(;n!==p;n=(n+1)%h){const{jitter:e}=f[n];e&&(u+=e,d++)}const y=d?Se(u/d):0,m=l>y?l:y;r(2===m||1===m&&c<=.2?c:0)}}}Ne=a,$e=e}break}}),400)}(it,Pt,r,qe,e),rt(3),e();try{const e=await it.getStats();let t;for(const[n,r]of e)if("candidate-pair"===r.type){t=r.localCandidateId;break}if(t)for(const[n,r]of e)if(n===t){const{candidateType:e}=r;Rt("ice",{protocol:"relay"===e?r.relayProtocol:r.protocol,candidateType:e});break}}catch(e){console.error("getStats failed",e)}let t=4;const n=()=>{const{readyState:r}=E;if(r||0==t--){const{forceTURN:e}=be;return r?ge(5,`buffered with ${4-t} retries`):ge(2,"failed buffering"),r||e||0!==Ae.data.length||(be.forceTURN=!0,Ge(O,1),Pt(),ge(4,"Force TURN","case 2")),void(Ut=void 0)}e(),Ut=setTimeout(n,t<2?4e3:2e3)};clearTimeout(Ut),Ut=setTimeout(n,2500);const o=it.getReceivers(),i=[];let a;for(const{track:e}of o){if("video"===e.kind){if(a)continue;if(a=e,p&&p(e),!U)continue}else f&&(E.muted=!0,f(e));i.push(e)}(d||p)&&(E.style.display="none"),E.srcObject=new MediaStream(i),E.onplaying=()=>{E.onplaying=null,rt(5),yt(y.getBoundingClientRect()),E.style.marginBottom="",pe&&e(),E.style.visibility="",w.style.display="none",d&&(async()=>{if(S){const e=new MediaStreamTrackProcessor(a).readable.getReader();let t;for(;;){const n=await e.read();if(n.done){t&&t.close();break}const r=n.value,o=await createImageBitmap(r);r.close(),d(o),t&&t.close(),t=o}}else if(E.requestVideoFrameCallback){const e=()=>{E.ended||ct()||(d(E),E.requestVideoFrameCallback(e))};e()}else{let e=0;const t=async()=>{if(E.ended||ct())return void clearInterval(n);let t;e:do{for(const[e,n]of await it.getStats())if("video"===n.kind&&1234!==n.ssrc){t=n.framesDecoded;break e}return}while(0);t>e&&(e=t,d(E))},n=setInterval(t,1e3/pt);t()}})()};try{await E.play(),E.style.filter="",V.style.display="none",$()}catch(e){if(!be.haveVM)return;Bt()}E.onpause=async()=>{try{await E.play()}catch(e){E.onpause=null,Nt(!0),rt(2),Bt()}}}catch(e){!1===e||console.error("failed to consume err:",e)}break;case"checking":I=setTimeout((()=>{be.forceTURN=!0,Ge(O,1),Pt()}),5e3);break;case"disconnected":Pt(e)}}));break}case _:const h=[];try{for(const{c:J,mime:X}of u)h.push(new ClipboardItem({[X||"text/plain"]:"string"==typeof J?J:new Blob([J],{type:X})}));await navigator.clipboard.write(h)}catch(G){if(G instanceof Error&&"NotAllowedError"===G.name&&h.length>1)try{await navigator.clipboard.write([h[0]])}catch(Z){}}break;case"warn":ge(6,"closeWarning",`type = ${u.type}`),null==r||r({type:"close_warning",data:u});break;case"peer_mouse":if(!("x"in u)){null==r||r({type:ke,data:u});break}const{x:m,y:g,userId:v}=u;let[b,k]=function(e,t,n){let{x:r,y:o,width:i,height:a}=e;return i*=lt/dt,a*=ut/ft,[Math.round(r+t*i),Math.round(o+n*a)]}(E.getBoundingClientRect(),m,g);null==r||r({type:ke,data:{x:m,y:g,clientX:b,clientY:k,userId:v}});break;case"rtt":!function(e,t){Fe&&Ve(t,e),Ie=e}(u,r);break;case"ext_reconn":null==r||r({type:"ext_reconn"});break;case"focus":(jt=u)?H():q();break;case"screenshot":null==r||r(c,[u.buf.buffer]);break;case"cursor":{const Q=c.data;if("buf"in Q){const{buf:ee,hx:te,hy:ne}=Q,re=URL.createObjectURL(function(e){const{byteLength:t}=e,n=e[4]<<24|e[5]<<16|e[6]<<8|e[7],r=e[8]<<24|e[9]<<16|e[10]<<8|e[11],o=n*r*4,i=122+o,a=new Uint8Array(i),s=new DataView(a.buffer);let c=0;function l(e){s.setUint16(c,e,!0),c+=2}function u(e){s.setUint32(c,e,!0),c+=4}l(19778),u(i),c+=4,u(122),u(108),u(n),u(-r),l(1),l(32),u(3),u(o),u(2835),u(2835),c+=8,u(16711680),u(65280),u(255),u(4278190080),u(1466527264);let d=14;const f=new Uint8Array(256);let p=0,h=0,y=0,m=0,w=255;const g=t-8;let v=0;for(c=122;c<i&&d<t-4;c+=4){if(v>0)v--;else if(d<g){const t=e[d++];if(254===t)h=e[d++],y=e[d++],m=e[d++];else if(255===t)h=e[d++],y=e[d++],m=e[d++],w=e[d++];else if(192&t)if(64==(192&t))h+=(t>>4&3)-2,y+=(t>>2&3)-2,m+=(3&t)-2,h=(h+256)%256,y=(y+256)%256,m=(m+256)%256;else if(128==(192&t)){const n=e[d++],r=(63&t)-32;h=(h+(r+(n>>4&15)-8)+256)%256,y=(y+r+256)%256,m=(m+(r+(15&n)-8)+256)%256}else 192&~t||(v=63&t);else h=f[4*t],y=f[4*t+1],m=f[4*t+2],w=f[4*t+3];p=(3*h+5*y+7*m+11*w)%64*4,f[p]=h,f[p+1]=y,f[p+2]=m,f[p+3]=w}a[c]=h,a[c+1]=y,a[c+2]=m,a[c+3]=w}return new Blob([a.buffer],{type:"image/bmp"})}(ee)),oe=`url(${re}) ${te} ${ne}`,ie=It[It.length-1];y.style.cursor=ie?`${oe},${ie[1]},none`:`${oe},none`,2===It.length&&URL.revokeObjectURL(It.shift()[0]),It.push([re,oe])}else{for(const ae of It)URL.revokeObjectURL(ae[0]);It.length=0,y.style.cursor=Mt[Q.enum]}break}case"resize":{const se=u;lt=se.width,ut=se.height,dt=se.rwidth,ft=se.rheight,null==r||r({type:"resize",data:{width:lt,height:ut}}),yt(y.getBoundingClientRect());break}case"masked_focus":_t=u,Ct();break;case"masked_blur":_t=void 0;break;case"openfile":{const{start_in:le,multiple:ue,any:de,filters:fe}=u,he=(e,t)=>(Y=t,e=>{Y=void 0,null==e||e("legacy cancel")});let ye;if(fe&&fe.length>0){let Ee=fe[0];const Re=[{startIn:le,multiple:ue,excludeAcceptAllOption:!de,legacySetup:he,description:Ee.desc,mimeTypes:Ee.mime,extensions:Ee.ext}];for(let Ue=1;Ue<fe.length;Ue++)Ee=fe[Ue],Re.push({description:Ee.desc,mimeTypes:Ee.mime,extensions:Ee.ext});ye=n(Re)}else ye=n({startIn:le,multiple:ue,legacySetup:he});let me=!1;const we=new FormData;try{const Pe=await ye;let He=0;for(const Je of Pe instanceof Array?Pe:[Pe])we.append(""+He++,Je),me=!0}catch(Ye){}finally{Y=void 0}const ve=new URL(i);ve.pathname+="/openfile",ve.search="";const xe=new XMLHttpRequest;if(xe.open("POST",ve,!0),xe.setRequestHeader("authorization",at),me){const Xe=document.createElement("progress");Xe.value=0,Xe.style.cssText="position:absolute;top:0;width:100%",xe.onload=()=>{Xe.remove()},xe.onerror=()=>{ge(3,"file upload failed"),Xe.remove()},xe.upload.onprogress=({loaded:e,total:t})=>{Xe.value=e/t},y.appendChild(Xe),xe.send(we)}else xe.send()}}}function Ct(){var e;if(_t){const{i:t,val:n,label:r}=_t;B(),q(),Rt("masked_set_value",{i:t,val:null!==(e=prompt(`${r?`${r}\n`:""}${n?`Current value: ${n}\n`:""}Enter new value`))&&void 0!==e?e:void 0}),_t=void 0}}const Mt=["none","alias","all-scroll","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","n-resize","ne-resize","nesw-resize","no-drop","not-allowed","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","s-resize","se-resize","sw-resize","text","vertical-text","w-resize","wait","zoom-in","zoom-out"];let Lt,It=[],jt=!1;async function Bt(){be.needInteraction=!0,V.style.display="",Qe.style.fill="rgba(0,0,0,0.3)",W.style.display="inline",E.style.filter="blur(5px)",E.muted=!0;try{await E.play()}catch(e){tt(1)}}function Nt(e=!1){var t;u||e?(t=e,U&&lt&&ut&&(w.width=lt,w.height=ut,w.getContext("2d").drawImage(E,0,0,lt,ut),w.style.filter=t?"blur(5px)":"",w.style.display="block"),E.style.visibility="hidden"):E.style.visibility="hidden",y.style.cursor="",E.style.filter="",V.style.display="none",ct()||(E.onpause=null,it.close(),it=void 0),be.haveVM=e,!e&&ot&&(St(),ot=void 0),clearTimeout(wt),clearInterval(Ut),Ut=void 0,We()}function Dt(t){if("m"in t)return void Tt(JSON.stringify(t));let n=!1;const{type:r}=t;switch(r){case"webhook_auth":kt(t.data);break;case"video_paused":Rt("video_paused",{paused:t.data});break;case"ping":Rt("ping");break;case"reconnect":Pt("manual");break;case"volume":E.volume=t.data;break;case"keydown":n=!0;case"keyup":G(t.key,!!t.ctrlKey,!!t.metaKey,n);break;case"mousemove":if(At())break;case"mousedown":case"mouseup":"mouseup"===r&&(_t?Ct():jt&&H()),de(ae[t.type],t.x,t.y,t.button);break;case"admin_token":Lt=t.data;break;case"delegate_keyboard":(c=t.data)||B();break;case"disable_input":(l=t.data)&&B();break;case"blur":e||document.activeElement===v||B();break;case"playout_delay":t.data?Re=!0:Re&&(qe(0),Re=!1);break;case"wheel":Rt("w",{axis:0,diff:t.deltaY});break;case"bitrate":Tt(JSON.stringify(t));break;case"text":we(t.text)}}return bt&&kt(),{handleMessage:Dt,destroy:function(){if(L.abort(),Nt(),rt(4),null==mt||mt.disconnect(),u)for(const e of[...y.children])e!==w&&e.remove();else y.remove()}}}qe();if(window!==window.top)console.warn("%cWARNING:\n%cRunning Hyperbeam in IFrame is deprecated\n%cPlease use the Hyperbeam JavaScript SDK with a div container\nhttps://docs.hyperbeam.com/client-sdk/javascript/reference","font-weight:bold;font-size:36px;color:red;","font-size:20px;font-weight:bold;","font-size:14px;color:gray;");}();</script></body></html>